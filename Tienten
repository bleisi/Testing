-- StarterPlayerScripts/AutoTpCandyGift.client.lua

local Players = game:GetService("Players")
local player = Players.LocalPlayer

local enabled = false
local lastTp = 0
local COOLDOWN = 0.5

local TARGET_NAMES = {
	Candy = true,
	Gift = true,
}

local function getChar()
	return player.Character or player.CharacterAdded:Wait()
end

local function getTeleportCFrameFromInstance(inst: Instance): CFrame?
	-- Supports Part or Model
	if inst:IsA("BasePart") then
		return inst.CFrame
	end

	if inst:IsA("Model") then
		-- Prefer PrimaryPart if set
		if inst.PrimaryPart then
			return inst.PrimaryPart.CFrame
		end
		-- Otherwise find any BasePart inside
		local part = inst:FindFirstChildWhichIsA("BasePart", true)
		if part then
			return part.CFrame
		end
	end

	return nil
end

local function tpTo(inst: Instance)
	if not enabled then return end

	local now = os.clock()
	if now - lastTp < COOLDOWN then return end
	lastTp = now

	local cf = getTeleportCFrameFromInstance(inst)
	if not cf then return end

	local char = getChar()
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	-- Teleport 5 studs above target
	char:PivotTo(cf + Vector3.new(0, 5, 0))
end

local function handleInstance(inst: Instance)
	if not enabled then return end
	if TARGET_NAMES[inst.Name] then
		task.wait(0.05) -- helps if it spawns then positions
		tpTo(inst)
	end
end

-- Listen for new spawns directly under workspace
workspace.ChildAdded:Connect(handleInstance)

-- Also check existing targets when toggling ON
local function teleportToExistingTargets()
	for _, child in ipairs(workspace:GetChildren()) do
		if TARGET_NAMES[child.Name] then
			tpTo(child)
		end
	end
end

-- ===== GUI =====
local gui = Instance.new("ScreenGui")
gui.Name = "AutoTpGUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 240, 0, 110)
frame.Position = UDim2.new(0, 20, 0, 120)
frame.Parent = gui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -20, 0, 24)
title.Position = UDim2.new(0, 10, 0, 8)
title.BackgroundTransparency = 1
title.Text = "Auto TP (Workspace Candy/Gift)"
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = frame

local toggle = Instance.new("TextButton")
toggle.Size = UDim2.new(1, -20, 0, 40)
toggle.Position = UDim2.new(0, 10, 0, 38)
toggle.Text = "OFF"
toggle.Parent = frame

local status = Instance.new("TextLabel")
status.Size = UDim2.new(1, -20, 0, 20)
status.Position = UDim2.new(0, 10, 0, 82)
status.BackgroundTransparency = 1
status.TextXAlignment = Enum.TextXAlignment.Left
status.Text = "Disabled"
status.Parent = frame

local function refreshUi()
	toggle.Text = enabled and "ON" or "OFF"
	status.Text = enabled and "Enabled (watching Workspace...)" or "Disabled"
end

toggle.MouseButton1Click:Connect(function()
	enabled = not enabled
	refreshUi()
	if enabled then
		teleportToExistingTargets()
	end
end)

refreshUi()
